# HTTP 接口测试用例说明

本目录包含药物相互作用查询系统的 HTTP 接口测试用例，使用标准 `.http` 格式编写，可直接在支持该格式的工具中运行。

## 文件说明

### 1. drugs.http
药物管理相关接口测试用例，包含：
- 获取药物列表（分页查询）
- 搜索药物（关键词搜索）
- 获取药物详情
- 保存药物信息
- AI 分析药物

**测试用例数量**：20个
**覆盖场景**：正常请求、边界条件、异常处理

### 2. interactions.http
药物相互作用检测接口测试用例，包含：
- 检测药物相互作用（2种、3种、5种药物）
- 获取相互作用详情
- 获取药物相互作用统计

**测试用例数量**：17个
**覆盖场景**：多药物组合、无效ID、重复ID、空数组等

### 3. graph.http
药物关系图谱接口测试用例，包含：
- 获取完整药物关系图谱
- 获取指定药物的关系图谱
- 获取图谱统计信息
- 综合场景测试

**测试用例数量**：11个
**覆盖场景**：全量数据、筛选查询、统计分析

### 4. comprehensive.http
综合业务场景测试用例，包含：
- 场景1：新药物录入与分析完整流程
- 场景2：药物相互作用检测流程
- 场景3：多药物联用安全性评估
- 场景4：药物关系图谱分析
- 场景5：药物信息查询与更新
- 场景6：批量药物分析
- 场景7：异常处理测试
- 场景8：边界条件测试

**测试用例数量**：40+个
**覆盖场景**：完整业务流程、异常处理、边界测试

## 使用方法

### 方式一：VS Code REST Client 插件

1. 安装 VS Code 插件：`REST Client`
2. 打开任意 `.http` 文件
3. 点击测试用例上方的 `Send Request` 按钮
4. 查看右侧响应结果

### 方式二：IntelliJ IDEA / WebStorm

1. 直接打开 `.http` 文件
2. 点击测试用例左侧的运行按钮
3. 查看响应结果

### 方式三：命令行工具

使用 `httpie` 或 `curl` 等命令行工具：

```bash
# 使用 httpie
http GET http://localhost:3000/api/drugs

# 使用 curl
curl -X GET http://localhost:3000/api/drugs
```

## 环境配置

测试用例默认使用以下配置：

```
@baseUrl = http://localhost:3000
@contentType = application/json
```

如需修改，请在各文件顶部更新变量值。

## 测试前准备

1. 确保后端服务已启动：
   ```bash
   cd backend
   npm install
   npm start
   ```

2. 确保 MongoDB 数据库已连接并包含测试数据

3. 确认 DeepSeek API 配置正确（用于 AI 分析功能）

## 测试数据说明

测试用例中使用的药物ID示例：
- `6938dc0ce1ed2492e2ef26b8` - 艾司唑仑
- `6938dc0ce1ed2492e2ef26b5` - 地西泮
- `6938dc0be1ed2492e2ef268e` - 氨氯地平
- `6938dc0ce1ed2492e2ef26a9` - 辛伐他汀
- `6938dc0ce1ed2492e2ef26ac` - 阿托伐他汀

**注意**：实际测试时请根据数据库中的真实数据替换这些ID。

## 测试覆盖范围

### 功能测试
- ✅ 药物列表查询
- ✅ 药物搜索
- ✅ 药物详情查询
- ✅ 药物信息保存
- ✅ AI 药物分析
- ✅ 药物相互作用检测
- ✅ 相互作用详情查询
- ✅ 相互作用统计
- ✅ 药物关系图谱
- ✅ 图谱统计信息

### 异常测试
- ✅ 无效ID格式
- ✅ 不存在的资源
- ✅ 缺少必填参数
- ✅ 空值参数
- ✅ 重复数据

### 边界测试
- ✅ 大页码查询
- ✅ 极值limit参数
- ✅ 负数参数
- ✅ 非法字符

## 预期响应格式

所有接口统一返回格式：

```json
{
  "success": true,
  "data": { ... },
  "timestamp": 1765345264998
}
```

错误响应格式：

```json
{
  "success": false,
  "error": "错误信息",
  "timestamp": 1765345264998
}
```

## 注意事项

1. 部分测试用例需要按顺序执行（如综合场景测试）
2. 涉及数据库写入的测试可能会影响数据，建议使用测试环境
3. AI 分析接口依赖外部 API，可能响应较慢
4. 某些测试用例中的ID需要根据实际数据库内容调整
5. 建议先运行单个接口测试，再执行综合场景测试

## 测试报告

执行测试后，建议记录：
- 测试时间
- 通过/失败用例数
- 响应时间统计
- 发现的问题

## 维护说明

当API接口发生变化时，需要同步更新：
1. 请求路径
2. 请求参数
3. 响应格式
4. 测试数据ID
5. 本文档说明
